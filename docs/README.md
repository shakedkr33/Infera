# תבנית אפליקציית מובייל (React Native & Convex)

ברוכים הבאים לתבנית הפיתוח לאפליקציית React Native עם Expo ו-Convex. תבנית זו מותאמת מראש לעברית (RTL) וכוללת מערכת אימות מלאה, ניווט ועיצוב מודרני.

## 📚 תוכן עניינים

1. [מבנה האפליקציה](#מבנה-האפליקציה)
2. [צעדים ראשונים](#צעדים-ראשונים)
3. [הגדרת מסד נתונים ואימות (Convex)](#הגדרת-מסד-נתונים-ואימות-convex)
4. [התקנה והרצה](#התקנה-והרצה)
5. [פיצ'רים מרכזיים](#פיצרים-מרכזיים)

---

## 🏗 מבנה האפליקציה

האפליקציה בנויה ממספר רכיבים מרכזיים:

- **Frontend (צד לקוח):**
  - **Expo & React Native:** התשתית לפיתוח האפליקציה למובייל (iOS ו-Android).
  - **Expo Router:** מערכת ניווט מבוססת קבצים (בתיקיית `app/`).
  - **NativeWind:** ספריית עיצוב המאפשרת שימוש ב-Tailwind CSS בתוך React Native.
  - **RTL Support:** תמיכה מובנית בשפות מימין-לשמאל (עברית), כולל פתרונות היברידיים ל-Expo Go ול-Production.

- **Backend (צד שרת):**
  - **Convex:** פלטפורמת Backend-as-a-Service המספקת מסד נתונים בזמן אמת, פונקציות שרת (Server Functions) ואימות משתמשים.
  - **Convex Auth:** מערכת אימות משתמשים מאובטחת המוטמעת ישירות ב-Convex.

### תיקיות חשובות:
- `app/`: מכילה את מסכי האפליקציה והניווט.
  - `(auth)/`: מסכי התחברות והרשמה (לפני אימות).
    - `paywall/`: מסך Paywall (תשלום).
  - `(authenticated)/`: מסכים הזמינים רק למשתמשים מחוברים (האפליקציה הראשית).
- `convex/`: מכילה את לוגיקת השרת (Schema, פונקציות, הגדרות אימות).
- `components/`: רכיבי UI לשימוש חוזר.
- `config/`: קבצי קונפיגורציה מרכזיים.
  - `appConfig.ts`: דגלי תכונות וקונפיגורציה כללית.
- `contexts/`: קונטקסטים גלובליים.
  - `RevenueCatContext.tsx`: ניהול מנויים ותשלומים.
- `utils/`: כלי עזר.
  - `revenueCatConfig.ts`: קונפיגורציית RevenueCat.
- `lib/`: ספריות עזר (כגון `rtl.ts` לתמיכה בעברית).

---

## 🚀 צעדים ראשונים (עם קבלת התבנית)

> 📖 **מדריך מפורט:** ראה `setup.md` להוראות התקנה מלאות עם צילומי מסך.

### דרישות מקדימות

לפני שמתחילים, התקינו את הכלים הבאים:

#### 1. Node.js

**🪟 Windows:**
1. גשו ל-[nodejs.org](https://nodejs.org) והורידו את גרסת LTS
2. בזמן ההתקנה, וודאו שהאפשרות **"Add to PATH"** מסומנת

**🍎 Mac:**
1. גשו ל-[nodejs.org](https://nodejs.org) והורידו את גרסת LTS (קובץ `.pkg`)
2. או דרך Homebrew: `brew install node`

#### 2. Git

**🪟 Windows:**
1. גשו ל-[git-scm.com/download/win](https://git-scm.com/download/win)
2. הורידו והתקינו **Git for Windows**

**🍎 Mac:**
1. פתחו Terminal והריצו: `git --version`
2. אם לא מותקן, Mac יציע להתקין Xcode Command Line Tools - לחצו Install
3. או דרך Homebrew: `brew install git`

#### 3. Bun

לאחר התקנת Node.js, הריצו בטרמינל:
```bash
npm i -g bun
```

#### 4. אימות ההתקנות

```bash
node -v
git --version
bun -v
```

> ❌ **אם `node -v` לא עובד ב-Windows:** סגרו את Cursor/VSCode לחלוטין ופתחו מחדש.

### שלבי התקנה

1. **הורדת התבנית:** הורידו וחלצו את התבנית מהפלטפורמה
2. **פתיחת הפרויקט:** פתחו את התיקייה ב-Cursor/VSCode
3. **התקנת חבילות:** התחילו בהתקנת התלויות: `bun install`
4. **הגדרת Convex:** צרו פרויקט וייצרו מפתחות אימות (Auth) - ראה `setup.md` לפרטים
5. **בדיקה ראשונית:** הריצו את האפליקציה וודאו שהכל עובד
6. **שמירה בענן:** שמרו את הקוד ב-GitHub

---

## 🗄 הגדרת מסד נתונים ואימות (Convex)

כדי שהאפליקציה תעבוד, עליכם לקשר אותה לפרויקט Convex וליצור מפתחות אימות:

1. **יצירת פרויקט:** הריצו `bunx convex dev`.
   - **חשוב:** במובייל, העתיקו את `NEXT_PUBLIC_CONVEX_URL` ל-`EXPO_PUBLIC_CONVEX_URL` בקובץ `.env`.
2. **יצירת מפתחות אימות:** הריצו `bunx @convex-dev/auth`.

---

## 📦 התקנה והרצה

### 1. התקנת חבילות
התקינו את כל התלויות של הפרויקט באמצעות bun:
```bash
bun install
```

### 2. הרצת השרת (Convex)
פתחו טרמינל נפרד והריצו את שרת הפיתוח של Convex (כדי לסנכרן שינויים ב-Backend בזמן אמת):
```bash
bunx convex dev
```
(השאירו את הטרמינל הזה פתוח ברקע).

### 3. הרצת האפליקציה (Expo)
בטרמינל נוסף, הריצו את האפליקציה:
```bash
bun dev
```
לאחר מכן:
- לחצו `i` כדי לפתוח בסימולטור **iOS**.
- לחצו `a` כדי לפתוח באמולטור **Android**.
- או סרקו את ה-QR Code עם אפליקציית **Expo Go** במכשיר הפיזי שלכם. (חייבים להיות מחוברים לאותו שרת או Wi-Fi)

---

---

## 🎯 פיצ'רים מרכזיים

### מערכת תשלומים (RevenueCat)
האפליקציה כוללת אינטגרציה מלאה עם [RevenueCat](https://www.revenuecat.com) למערכת תשלומים:
- **Paywall Screen:** מסך תשלום בעברית עם תוכניות מנוי (חודשי, שנתי)
- **RevenueCat Context:** ניהול מנויים, רכישות ושחזור רכישות
- **Mock Payments:** מצב בדיקה שמאפשר לבדוק את ה-Paywall בלי תשלום אמיתי
- **Webhook Integration:** סנכרון אוטומטי של סטטוס מנוי ל-Convex Database

📖 **מדריך הגדרה:** ראה `docs/REVENUECAT_SETUP.md` להגדרה מפורטת ל-iOS ו-Android.

### קונפיגורציה מרכזית (`appConfig.ts`)
קובץ קונפיגורציה מרכזי לניהול דגלי תכונות:
- `PAYMENT_SYSTEM_ENABLED`: הפעלה/כיבוי של מערכת התשלומים האמיתית
- `MOCK_PAYMENTS`: מצב בדיקה לתשלומים מדומים
- `IS_DEV_MODE`: זיהוי אוטומטי של מצב פיתוח (מבוסס על `__DEV__`)
- `APP_ENV`: סביבה נוכחית (`dev` או `prod`) - נגזרת אוטומטית מ-`__DEV__`

### מחיקת חשבון
משתמשים יכולים למחוק את החשבון שלהם דרך מסך ההגדרות, עם אישור דו-שלבי.

---

## 💡 טיפים נוספים

- **עברית (RTL):** האפליקציה מוגדרת לעבוד מימין לשמאל. אם אתם מוסיפים מסכים חדשים, השתמשו בקבצי העזר ב-`lib/rtl.ts` כדי להבטיח התאמה מלאה.
- **אבטחה:** מפתחות API סודיים לא נשמרים בקוד אלא במשתני סביבה. ודאו שקובץ `.env` לא עולה ל-Git (הוא כבר ב-.gitignore).
- **בדיקות:** הריצו `bun run check` כדי לוודא שאין שגיאות קוד לפני ביצוע שינויים משמעותיים.
- **תשלומים:** לפני פריסה לייצור, ודאו שמוגדרים כל משתני הסביבה הנדרשים (ראה `docs/REVENUECAT_SETUP.md`).

בהצלחה בפיתוח! 🚀
